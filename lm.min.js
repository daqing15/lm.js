function lm(e){if(!e){throw new Error("Please provide a name for the db")}db.store(e,{});this.namespace=e;this.collections=[]}function Collection(e,t){this.name=e;this.namespace=t}function Query(e,t){this.namespace=e;this.collectionName=t}function Document(e,t){this.namespace=e;this.collectionName=t}function isEqual(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;var i=toString.call(e);if(i!=toString.call(t))return false;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return false;var s=n.length;while(s--){if(n[s]==e)return r[s]==t}n.push(e);r.push(t);var o=0,u=true;if(i=="[object Array]"){o=e.length;u=o==t.length;if(u){while(o--){if(!(u=eq(e[o],t[o],n,r)))break}}}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(typeof a==="function"&&a instanceof a&&typeof f==="function"&&f instanceof f)){}for(var l in e){if(hasOwnProperty.call(e,l)){o++;if(!(u=hasOwnProperty.call(t,l)&&isEqual(e[l],t[l],n,r)))break}}if(u){for(l in t){if(hasOwnProperty.call(t,l)&&!(o--))break}u=!o}}n.pop();r.pop();return u}lm.prototype.create=function(e,t){if(!e){throw new Error("Please specify a name")}var n=db.retrieve(this.namespace);n[e]=t||[];db.store(this.namespace,n);this.collections.push(e);return new Collection(e,this.namespace)};lm.prototype.remove=function(e){if(!e){throw new Error("Please specify a name")}var t=this.collections.indexOf(e);if(t<0){throw new Error("Collection does not exist")}this.collections.splice(t,1);var n=db.retrieve(this.namespace);delete n[e];db.store(this.namespace,n);return this};lm.prototype.get=function(e){if(!e){throw new Error("Please specify a name")}var t=this.collections.indexOf(e);if(t<0){throw new Error("Collection does not exist")}return new Query(this.namespace,e)};Collection.prototype.add=function(e){if(typeof e!=="object"){throw new Error("Expecting an object but got "+typeof e)}var t=db.retrieve(this.namespace);t[this.name].push(e);db.store(this.namespace,t);return this};Query.prototype.find=function(e,t){if(!arguments.length){throw new Error("Please specify a criteria or a callback")}if(typeof e==="function"){t=e;e={}}var n=db.retrieve(this.namespace);var r=n[this.collectionName];if(!Object.keys(e).length){t(r)}else{var i=Object.keys(e);var s=new Document(this.namespace,this.collectionName);var o=r.filter(function(t){var n=0;for(var r=i.length-1;r>=0;r--){if(t[i[r]]===e[i[r]]){n++;t.__proto__=s;if(n===i.length){return true}}}});o.__proto__=this;t(o)}return this};Document.prototype.update=function(e){var t=this;var n=Object.keys(e);var r=db.retrieve(this.namespace);var i=r[this.collectionName];var s=i.map(function(r){for(var i=n.length-1;i>=0;i--){if(r[n[i]]===t[n[i]]){r[n[i]]=e[n[i]];t[n[i]]=e[n[i]]}}return r});r[this.collectionName]=s;db.store(this.namespace,r);return t};Document.prototype.remove=function(){var e=this;var t=db.retrieve(this.namespace);var n=t[this.collectionName];var r=n.filter(function(t){return!isEqual(t,e,[],[])});t[this.collectionName]=r;db.store(this.namespace,t);e=undefined;var i=Object.keys(this);for(var s=i.length-1;s>=0;s--){this[i[s]]=undefined}return e};var db={};db.store=function(e,t){localStorage.setObject(e,t)};db.retrieve=function(e){return localStorage.getObject(e)};db.remove=function(){localStorage.removeObject(key)};db.exists=function(e){var t=localStorage.getObject(e);return!!t&&!!Object.keys(t).length};db.clear=function(){localStorage.clear()};Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))};Storage.prototype.getObject=function(e){var t=this.getItem(e);var n=t&&JSON.parse(t);if(typeof n=="string"){n=n&&JSON.parse(n)}return n};Storage.prototype.removeObject=function(e){this.removeItem(e)};
